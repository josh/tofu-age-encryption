env TF_INPUT=false
env TF_INPUT=false
env TF_CLI_ARGS=-no-color

exec tofu init

exec tofu apply -auto-approve -lock=false
exec python -m json.tool terraform.tfstate
exec cat terraform.tfstate
! stdout foo
! stdout bar

exec tofu apply -auto-approve -lock=false
exec python -m json.tool terraform.tfstate
exec cat terraform.tfstate
! stdout foo
! stdout bar

-- main.tf --
terraform {
  encryption {
    key_provider "pbkdf2" "example" {
      passphrase = "abcdefghijklmnopqrstuvxyz"
    }

    method "aes_gcm" "example" {
      keys = key_provider.pbkdf2.example
    }

    state {
      method = method.aes_gcm.example
      enforced = true
    }

    plan {
      method = method.aes_gcm.example
      enforced = true
    }
  }
}

output "foo" {
  value = "bar"
}
